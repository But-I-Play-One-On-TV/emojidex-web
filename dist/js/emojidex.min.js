/*
 *  jQuery Emojidex - v0.1.0
 *  emojidex coffee plugin for jQuery/Zepto and compatible
 *  https://github.com/emojidex/emojidex-coffee#emojidex-coffee
 *
 *  Made by emojidex
 *  Under LGPL License
 *  https://www.gnu.org/licenses/lgpl.html License
 */
(function(){var a,b,c,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};!function(a){var c,d,e;return e="emojidex",d={emojiarea:{plain_text:".emojidex-plain_text",content_editable:".emojidex-content_editable"}},a.fn[e]=function(b){return this.each(function(){return a.data(this,"plugin_"+e)?void 0:a.data(this,"plugin_"+e,new c(this,b))})},c=function(){function c(c,f){var g=this;this.element=c,this.emoji_data_array=[],this.options=a.extend({},d,f),this._defaults=d,this._name=e,this.api_emoji=new b(this.element,this.options),this.api_emoji.load(function(){return g.emoji_data_array.push(g.api_emoji.emoji_data),g.checkLoadedEmojiData()})}return c.prototype.checkLoadedEmojiData=function(){return this.emoji_data_array?this.setAutoComplete(this.options):void 0},c.prototype.setAutoComplete=function(b){var c,d,e,f,g,h,i,j,k,l,m,n;for(e=[],m=this.emoji_data_array,i=0,k=m.length;k>i;i++){f=m[i];for(d in f)for(n=f[d],j=0,l=n.length;l>j;j++)g=n[j],e.push({code:g.code,img_url:g.img_url})}return h=function(){return console.log(111)},c={callback:h,at:":",limit:10,search_key:"code",data:e,tpl:"<li data-value=':${code}:'><img src='${img_url}' height='20' width='20' /> ${code}</li>",insert_tpl:"<img src='${img_url}' height='20' width='20' />"},a(b.emojiarea.plain_text).atwho(c),a(b.emojiarea.content_editable).atwho(c)},c.prototype.setEmojiarea=function(b){return b.emojiarea.plaintext.emojiarea({wysiwyg:!1}),b.emojiarea.wysiwyg.on("change",function(){return console.dir(this),b.emojiarea.rawtext.text(a(this).val())}),b.emojiarea.wysiwyg.trigger("change")},c}()}(jQuery,window,document),this.EmojidexClient=function(){function a(a){if(null==a&&(a={}),this.defaults={locale:"en",pre_cache_utf:!1,pre_cache_extended:!1,pre_cache_categories:!0,api_uri:"https://www.emojidex.com/api/v1/",cdn_uri:"http://cdn.emojidex.com/emoji",size_code:"px32",detailed:!1,limit:32},a=$.extend({},this.defaults,a),this.api_uri=a.api_uri,this.cdn_uri=a.cdn_uri,this.size_code=a.size_code,this.detailed=a.detailed,this.limit=a.limit,this.emoji=a.emoji||[],this.history=a.history||[],this.favorites=a.favorites||[],this.results=a.results||[],this.page=1,this.count=0,this.categories=[],a.pre_cache_categories&&this.get_categories(null,{locale:a.locale}),this.next=function(){return null},this.auto_login()&&(get_history,get_favorites),a.pre_cache_utf)switch(a.locale){case"en":this.user_emoji("emoji");break;case"ja":this.user_emoji("絵文字")}if(a.pre_cache_extended)switch(a.locale){case"en":this.user_emoji("emojidex");break;case"ja":this.user_emoji("絵文字デックス")}}return a.prototype.search=function(a,b,c){var d=this;return null==b&&(b=null),this.next=function(){return this.search(a,b,$.extend(c,{page:c.page+1}))},c=this._combine_opts(c),$.getJSON(this.api_uri+"search/emoji?"+$.param($.extend({},{code_cont:this._escape_term(a)},c))).error(function(){return d.results=[]}).success(function(a){return d._succeed(a,b)})},a.prototype.tag_search=function(a,b,c){var d=this;return null==b&&(b=null),this.next=function(){return this.tag_search(term,b,$.extend(c,{page:c.page+1}))},c=this._combine_opts(c),$.getJSON(this.api_uri+"search/emoji?"+$.param($.extend({},{"tags[]":this._breakout(a)},c))).error(function(){return d.results=[]}).success(function(a){return d._succeed(a,b)})},a.prototype.advanced_search=function(a,b,c,d,e){var f,g=this;return null==b&&(b=[]),null==c&&(c=[]),null==d&&(d=null),this.next=function(){return this.advanced_search(a,b,c,d,$.extend(e,{page:e.page+1}))},e=this._combine_opts(e),f={code_cont:this._escape_term(a)},b.length>0&&(f=$.extend(f,{"tags[]":this._breakout(b)})),c.length>0&&(f=$.extend(f,{"categories[]":this._breakout(c)})),$.getJSON(this.api_uri+"search/emoji?"+$.param($.extend(f,e))).error(function(){return g.results=[]}).success(function(a){return g._succeed(a,d)})},a.prototype.user_emoji=function(a,b,c){var d=this;return null==b&&(b=null),c=this._combine_opts(c),$.getJSON(this.api_uri+"users/"+a+"/emoji?"+$.param(c)).error(function(){return d.results=[]}).success(function(a){return d._succeed(a,b)})},a.prototype.get_categories=function(a,b){var c=this;return null==a&&(a=null),b=this._combine_opts(b),$.getJSON(this.api_uri+"categories?"+$.param(b)).error(function(){return c.categories=[],[]}).success(function(b){return c.categories=b.categories,a?a(b.categories):void 0})},a.prototype.auto_login=function(){return this.username=null,this.api_key=null},a.prototype.login=function(a,b){null==a&&(a=null),null==b&&(b=nil)},a.prototype.get_history=function(a,b){null==a&&(a=1),null==b&&(b=50)},a.prototype.set_history=function(){},a.prototype.get_favorites=function(a,b){null==a&&(a=1),null==b&&(b=50)},a.prototype.set_favorites=function(){},a.prototype.combine_emoji=function(a){return $.extend(this.emoji,a)},a.prototype.simplify=function(a,b){var c,d,e,f;for(null==a&&(a=this.emoji),null==b&&(b=this.size_code),f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push({code:c.code,img_url:""+this.cdn_uri+"/"+b+"/"+c.code+".png"});return f},a.prototype._combine_opts=function(a){return $.extend({},{page:1,limit:this.limit,detailed:this.detailed},a)},a.prototype._succeed=function(a,b){return this.results=a.emoji,this.page=a.meta.page,this.count=a.meta.count,this.combine_emoji(a.emoji),b?b(a.emoji):void 0},a.prototype._breakout=function(a){return null===a?[]:(a instanceof Array||(a=[a]),a)},a.prototype._escape_term=function(a){return a.split(" ").join("_")},a.prototype._de_escape_term=function(a){return a.split("_").join(" ")},a}(),a=function(){function a(){}return a.prototype.emoji_data=null,a.prototype.element=null,a.prototype.options=null,a.prototype.emoji_regexps=null,a.prototype.getCategorizedData=function(a){var b,c,d,e;for(c={},d=0,e=a.length;e>d;d++)b=a[d],null===b.category?null==c.uncategorized?c.uncategorized=[b]:c.uncategorized.push(b):null==c[b.category]?c[b.category]=[b]:c[b.category].push(b);return c},a.prototype.setEmojiCSS_getEmojiRegexps=function(a){var b,c,d,e,f,g,h,i;g="",f=":(",d=$('<style type="text/css" />');for(b in a)for(e=a[b],h=0,i=e.length;i>h;h++)c=e[h],g+=c.moji+"|",f+=c.code+"|",d.append("i.emojidex-"+c.code+" {background-image: url('"+c.img_url+"')}");return $("head").append(d),{utf:g.slice(0,-1),code:f.slice(0,-1)+"):"}},a.prototype.getEmojiTag=function(a){return'<i class="emojidex-'+a+'"></i>'},a.prototype.replaceForUTF=function(b){var c;return c=b.s_replace.replace(new RegExp(b.regexp,"g"),function(c){var d,e,f,g,h;for(d in b.emoji_data)for(h=b.emoji_data[d],f=0,g=h.length;g>f;f++)if(e=h[f],e.moji===c)return a.prototype.getEmojiTag(e.code)})},a.prototype.replaceForCode=function(b){var c;return c=b.s_replace.replace(new RegExp(b.regexp,"g"),function(c){var d,e,f,g,h;c=c.replace(/:/g,"");for(d in b.emoji_data)for(h=b.emoji_data[d],f=0,g=h.length;g>f;f++)if(e=h[f],e.code===c)return a.prototype.getEmojiTag(e.code)})},a.prototype.setEmojiIcon=function(b){return $(this.element).find(":not(iframe,textarea,script)").andSelf().contents().filter(function(){return this.nodeType===Node.TEXT_NODE}).each(function(){var c;return c=this.textContent,null!=b.emoji_regexps.utf&&(c=a.prototype.replaceForUTF({s_replace:c,regexp:b.emoji_regexps.utf,emoji_data:b.emoji_data})),null!=b.emoji_regexps.code&&(c=a.prototype.replaceForCode({s_replace:c,regexp:b.emoji_regexps.code,emoji_data:b.emoji_data})),$(this).replaceWith(c)})},a}(),b=function(a){function b(a,c){this.element=a,this.options=c,b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.load=function(a){var b,c=this;return b=function(b){var d,e,f;for(e=0,f=b.length;f>e;e++)d=b[e],d.code=d.code.replace(RegExp(" ","g"),"_"),d.img_url="http://assets.emojidex.com/emoji/px32/"+d.code+".png";return c.emoji_data=c.getCategorizedData(b),c.emoji_regexps=c.setEmojiCSS_getEmojiRegexps(c.emoji_data),c.setEmojiIcon(c),a(c)},this.getEmojiDataFromAPI(b),this},b.prototype.getEmojiDataFromAPI=function(a){var b,c,d,e,f,g,h;for(c=0,e=["emojidex","emoji"],b=[],h=[],f=0,g=e.length;g>f;f++)d=e[f],$.ajaxSetup({beforeSend:function(a){return a.user_name=d}}),h.push($.ajax({url:"https://www.emojidex.com/api/v1/users/"+d+"/emoji",dataType:"json",type:"get",success:function(d){return b=b.concat(d.emoji),++c===e.length?a(b):void 0},error:function(a){return console.log("error: load json"),console.log(a)}}));return h},b}(a),c=function(){function a(a,b,c){this.emoji_data_array=a,this.element=b,this.options=c,this.KEY_ESC=27,this.KEY_TAB=9}return a.prototype.setPallet=function(){},a}()}).call(this);